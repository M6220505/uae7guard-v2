#!/usr/bin/env python3
â€œâ€â€
UAE7Guard Technical Testing & Validation Script
Tests the wallet address from the sample report and demonstrates enhanced analysis
â€œâ€â€

import json
import hashlib
from datetime import datetime, timedelta

def validate_ethereum_address(address):
â€œâ€â€œValidate Ethereum address formatâ€â€â€
if not address.startswith(â€˜0xâ€™):
return False, â€œAddress must start with 0xâ€
if len(address) != 42:
return False, fâ€Address length is {len(address)}, should be 42â€
try:
int(address[2:], 16)
return True, â€œValid Ethereum address formatâ€
except ValueError:
return False, â€œAddress contains invalid hexadecimal charactersâ€

def calculate_checksum_address(address):
â€œâ€â€œCalculate EIP-55 checksum for Ethereum addressâ€â€â€
address = address.lower().replace(â€˜0xâ€™, â€˜â€™)
hash_address = hashlib.sha3_256(address.encode()).hexdigest()
checksum_address = â€˜0xâ€™

```
for i, char in enumerate(address):
    if int(hash_address[i], 16) >= 8:
        checksum_address += char.upper()
    else:
        checksum_address += char

return checksum_address
```

def enhanced_risk_scoring(tx_count, wallet_age_days, balance_eth, threat_score):
â€œâ€â€
Enhanced risk scoring algorithm
More sophisticated than the current formula
â€œâ€â€
# Weight factors
W_AGE = 0.20
W_ACTIVITY = 0.25
W_VALUE = 0.20
W_PATTERN = 0.20
W_THREAT = 0.15

```
# Age risk (0-100, higher = riskier)
if wallet_age_days == 0:
    age_risk = 100
elif wallet_age_days < 7:
    age_risk = 80
elif wallet_age_days < 30:
    age_risk = 60
elif wallet_age_days < 90:
    age_risk = 40
elif wallet_age_days < 365:
    age_risk = 20
else:
    age_risk = 0

# Activity risk
if tx_count == 0:
    activity_risk = 100
elif tx_count < 5:
    activity_risk = 80
elif tx_count < 20:
    activity_risk = 50
elif tx_count < 100:
    activity_risk = 20
else:
    activity_risk = 0

# Value risk (balance pattern)
if balance_eth == 0:
    value_risk = 80
elif balance_eth < 0.01:
    value_risk = 60
elif balance_eth < 0.1:
    value_risk = 40
elif balance_eth < 1:
    value_risk = 20
else:
    value_risk = 10

# Pattern risk (placeholder - would analyze transaction patterns)
pattern_risk = 50  # Default moderate risk without history

# Threat database risk
threat_risk = threat_score * 100

# Calculate weighted risk score
risk_score = (
    W_AGE * age_risk +
    W_ACTIVITY * activity_risk +
    W_VALUE * value_risk +
    W_PATTERN * pattern_risk +
    W_THREAT * threat_risk
)

# Determine risk level
if risk_score <= 25:
    risk_level = "LOW RISK"
    color = "GREEN"
    recommendation = "Proceed with standard protocols"
elif risk_score <= 50:
    risk_level = "MODERATE RISK"
    color = "YELLOW"
    recommendation = "Enhanced due diligence recommended"
elif risk_score <= 75:
    risk_level = "HIGH RISK"
    color = "ORANGE"
    recommendation = "Additional verification required"
else:
    risk_level = "CRITICAL RISK"
    color = "RED"
    recommendation = "Transaction not recommended without thorough investigation"

return {
    'score': round(risk_score, 2),
    'level': risk_level,
    'color': color,
    'recommendation': recommendation,
    'breakdown': {
        'age_component': round(W_AGE * age_risk, 2),
        'activity_component': round(W_ACTIVITY * activity_risk, 2),
        'value_component': round(W_VALUE * value_risk, 2),
        'pattern_component': round(W_PATTERN * pattern_risk, 2),
        'threat_component': round(W_THREAT * threat_risk, 2)
    }
}
```

def analyze_uae7guard_report():
â€œâ€â€œAnalyze the sample UAE7Guard reportâ€â€â€

```
print("=" * 80)
print("UAE7GUARD TECHNICAL TESTING & VALIDATION REPORT")
print("=" * 80)
print(f"\nTest Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
print("\n" + "-" * 80)
print("1. WALLET ADDRESS VALIDATION")
print("-" * 80)

# Test wallet from report
test_wallet = "0xa797a0b99b887eba09552334d4d58d7246220c30"

is_valid, message = validate_ethereum_address(test_wallet)
print(f"\nWallet Address: {test_wallet}")
print(f"Validation Status: {'âœ“ VALID' if is_valid else 'âœ— INVALID'}")
print(f"Details: {message}")

# Calculate checksum
checksum_addr = calculate_checksum_address(test_wallet)
print(f"EIP-55 Checksum: {checksum_addr}")
print(f"Checksum Match: {'âœ“ YES' if checksum_addr.lower() == test_wallet.lower() else 'âœ— NO'}")

print("\n" + "-" * 80)
print("2. CURRENT RISK SCORING ANALYSIS")
print("-" * 80)

# Current formula from report
current_score = 40
current_formula = "(100 Ã— 0.4) + (0 Ã— 0.6) / âˆš365 = 40"

print(f"\nCurrent Risk Score: {current_score}/100")
print(f"Current Formula: {current_formula}")
print(f"Current Risk Level: SUSPICIOUS")

print("\nâš ï¸  ISSUES IDENTIFIED:")
print("   â€¢ Formula appears to have mathematical inconsistencies")
print("   â€¢ Unexplained constants (0.4, 0.6)")
print("   â€¢ Limited factors considered (only transaction count)")
print("   â€¢ No consideration for wallet age, balance, or patterns")
print("   â€¢ Time component (âˆš365) lacks clear justification")

print("\n" + "-" * 80)
print("3. ENHANCED RISK SCORING DEMONSTRATION")
print("-" * 80)

# Apply enhanced scoring to the test wallet
# Based on report data: 0 transactions, N/A balance, 0 threats
enhanced = enhanced_risk_scoring(
    tx_count=0,
    wallet_age_days=0,  # Assumed new wallet
    balance_eth=0,
    threat_score=0
)

print(f"\nEnhanced Risk Score: {enhanced['score']}/100")
print(f"Enhanced Risk Level: {enhanced['level']} ({enhanced['color']})")
print(f"Recommendation: {enhanced['recommendation']}")

print(f"\nScore Breakdown:")
for component, value in enhanced['breakdown'].items():
    component_name = component.replace('_', ' ').title()
    print(f"   â€¢ {component_name}: {value:.2f}")

print("\nâœ“ IMPROVEMENTS:")
print("   â€¢ Multi-factor analysis (age, activity, value, pattern, threats)")
print("   â€¢ Clear weighting system with documented rationale")
print("   â€¢ Actionable recommendations based on risk level")
print("   â€¢ Transparent scoring breakdown for audit purposes")
print("   â€¢ Gradual risk levels instead of binary classification")

print("\n" + "-" * 80)
print("4. RECOMMENDATION SUMMARY")
print("-" * 80)

print("\nğŸ”´ CRITICAL FINDING:")
print("   For a wallet with 0 transactions and no balance, proposing a")
print("   AED 500,000 transaction is EXTREMELY HIGH RISK.")

print("\nğŸ“Š COMPARISON:")
print(f"   Current UAE7Guard Score: {current_score}/100 (SUSPICIOUS)")
print(f"   Enhanced Algorithm Score: {enhanced['score']}/100 ({enhanced['level']})")

print("\nğŸ’¡ RECOMMENDATIONS:")
print("   1. Implement enhanced multi-factor risk algorithm")
print("   2. Add clear explanation of risk components in reports")
print("   3. Include actionable recommendations for each risk level")
print("   4. Document scoring methodology in public whitepaper")
print("   5. Add historical context and industry benchmarks")

print("\n" + "-" * 80)
print("5. ADDITIONAL TESTING SCENARIOS")
print("-" * 80)

scenarios = [
    {
        'name': 'New Active Wallet',
        'tx_count': 25,
        'age_days': 45,
        'balance': 0.5,
        'threats': 0
    },
    {
        'name': 'Established Wallet',
        'tx_count': 500,
        'age_days': 730,
        'balance': 5.0,
        'threats': 0
    },
    {
        'name': 'Suspicious Pattern',
        'tx_count': 3,
        'age_days': 2,
        'balance': 0.001,
        'threats': 0
    },
    {
        'name': 'Flagged Wallet',
        'tx_count': 100,
        'age_days': 180,
        'balance': 1.0,
        'threats': 0.8
    }
]

print("\nTesting Enhanced Algorithm on Various Scenarios:\n")

for scenario in scenarios:
    result = enhanced_risk_scoring(
        scenario['tx_count'],
        scenario['age_days'],
        scenario['balance'],
        scenario['threats']
    )
    
    print(f"Scenario: {scenario['name']}")
    print(f"   Transactions: {scenario['tx_count']}, Age: {scenario['age_days']} days")
    print(f"   Balance: {scenario['balance']} ETH, Threat Score: {scenario['threats']}")
    print(f"   â†’ Risk: {result['score']:.1f}/100 ({result['level']})")
    print(f"   â†’ {result['recommendation']}\n")

print("=" * 80)
print("TEST COMPLETE")
print("=" * 80)

# Save results to JSON
test_results = {
    'test_date': datetime.now().isoformat(),
    'wallet_tested': test_wallet,
    'validation': {
        'is_valid': is_valid,
        'format': 'Ethereum',
        'checksum': checksum_addr
    },
    'current_system': {
        'score': current_score,
        'formula': current_formula,
        'level': 'SUSPICIOUS'
    },
    'enhanced_system': enhanced,
    'test_scenarios': scenarios
}

with open('/home/claude/uae7guard_test_results.json', 'w') as f:
    json.dump(test_results, f, indent=2)

print("\nâœ“ Test results saved to: uae7guard_test_results.json")
```

if **name** == â€œ**main**â€:
analyze_uae7guard_report()